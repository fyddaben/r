function main(){var e=document.getElementById("webgl"),t=getWebGLContext(e);if(!t)return void console.log("Failed to get the rendering context for WebGL");var r=$("#vsh_tmpl").html(),o=$("#fsh_tmpl").html();if(!initShaders(t,r,o))return void console.log("Failed to intialize shaders.");var i=initVertexBuffers(t);if(0>i)return void console.log("Failed to set the vertex information");t.clearColor(0,0,0,1),t.enable(t.DEPTH_TEST);var n=t.getUniformLocation(t.program,"u_ModelMatrix"),a=t.getUniformLocation(t.program,"u_MvpMatrix"),f=t.getUniformLocation(t.program,"u_NormalMatrix"),l=t.getUniformLocation(t.program,"u_LightColor"),u=t.getUniformLocation(t.program,"u_LightPosition"),s=t.getUniformLocation(t.program,"u_AmbientLight");if(!(n&&a&&f&&l&&u&&s))return void console.log("Failed to get the storage location");t.uniform3f(l,.8,.8,.8),t.uniform3f(u,5,8,7),t.uniform3f(s,.2,.2,.2);var g=new Matrix4,m=new Matrix4,h=new Matrix4;g.setRotate(90,0,1,0),m.setPerspective(30,e.width/e.height,1,100),m.lookAt(0,0,6,0,0,0,0,1,0),m.multiply(g),h.setInverseOf(g),h.transpose(),t.uniformMatrix4fv(n,!1,g.elements),t.uniformMatrix4fv(a,!1,m.elements),t.uniformMatrix4fv(f,!1,h.elements),t.clear(t.COLOR_BUFFER_BIT|t.DEPTH_BUFFER_BIT),t.drawElements(t.TRIANGLES,i,t.UNSIGNED_SHORT,0)}function initVertexBuffers(e){var t,r,o,i,n,a,f,l,u,s,g=13,m=[],h=[];for(n=0;g>=n;n++)for(a=n*Math.PI/g,f=Math.sin(a),l=Math.cos(a),t=0;g>=t;t++)r=2*t*Math.PI/g,o=Math.sin(r),i=Math.cos(r),m.push(o*f),m.push(l),m.push(i*f);for(n=0;g>n;n++)for(t=0;g>t;t++)u=n*(g+1)+t,s=u+(g+1),h.push(u),h.push(s),h.push(u+1),h.push(u+1),h.push(s),h.push(s+1);if(!initArrayBuffer(e,"a_Position",new Float32Array(m),e.FLOAT,3))return-1;if(!initArrayBuffer(e,"a_Normal",new Float32Array(m),e.FLOAT,3))return-1;e.bindBuffer(e.ARRAY_BUFFER,null);var c=e.createBuffer();return c?(e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,c),e.bufferData(e.ELEMENT_ARRAY_BUFFER,new Uint16Array(h),e.STATIC_DRAW),h.length):(console.log("Failed to create the buffer object"),-1)}function initArrayBuffer(e,t,r,o,i){var n=e.createBuffer();if(!n)return console.log("Failed to create the buffer object"),!1;e.bindBuffer(e.ARRAY_BUFFER,n),e.bufferData(e.ARRAY_BUFFER,r,e.STATIC_DRAW);var a=e.getAttribLocation(e.program,t);return 0>a?(console.log("Failed to get the storage location of "+t),!1):(e.vertexAttribPointer(a,i,o,!1,0,0),e.enableVertexAttribArray(a),!0)}